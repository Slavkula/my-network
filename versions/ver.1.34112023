В этой версии вернулся к чему-то более простому, а именно: настраиваю сеть небольшого свечного заводика.
Она подключена к моей глобальной, общий вид на скрине тут: https://github.com/Slavkula/my-network/blob/main/PNG/ver.1.34112023.3.PNG
Использую этот плейбук, в нём задействованы модули: https://github.com/Slavkula/my-network/blob/main/playbooks/Fili_routers


1. Hostname.
2. Адресация - этот модуль раздаёт адреса (удивительно) на указанные интерфейсы. Сами интерфейсы он не включает, можно добавить отдельную задачу, но зачем, 
если у меня есть нормально оформленный (на мой взгляд) плейбук. В следующий раз использую его.
3. HSRP - не нашёл подходящего модуля для роутеров, поэтому пришлось написать задачу как есть. Аутентификацию, таймеры, mac-address и что там ещё есть,
я не стал настраивать.
4. Loopback-интерфейс. Я просто забыл его добавить во второй пункт, поэтому вынесен отдельно.
5. NAT-PAT. Созданы ацл для адресов, которые надо натить. Задан тип ната, настроены интерфейсы inside-outside. 

6. Несколько отдельно, потому что не нашёл ip sla модулей для настройки с использованием ансибл и сделал всё руками:
а) Сперва создал два маршрута по умолчанию на R17, т.к. он у меня основной роутер:
ip route 0.0.0.0 0.0.0.0 10.17.6.2 track 1
ip route 0.0.0.0 0.0.0.0 172.17.18.2 150
б) Настроил сам тест:
ip sla 1
icmp-echo 10.17.6.2
frequency 5
exit
ip sla schedule 1 life forever start-time now
track 1 ip sla 1 reachability

Теперь, если отключить интерфейс e1/0 на R6, то первый статический маршрут пропадёт из таблицы и его заменит второй с большим AD, а доступ в интернет останется

в) на втором роутере (R18), нужно добавить маршрут по умолчанию, чтобы пакеты можно было продолжать отсылать в интернет:
Ip route 0.0.0.0 0.0.0.0 10.18.6.2


